<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>신규 프리랜서 작가 안내 · TEST (지원자용)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * {
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
        "Noto Sans KR", sans-serif;
    }

    body {
      margin: 0;
      background: #f3f4f6;
      color: #111827;
    }

    .page {
      max-width: 1100px;
      margin: 20px auto 40px;
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 12px 32px rgba(15, 23, 42, 0.12);
      padding: 20px 22px 24px;
    }

    h1 {
      margin: 0 0 6px;
      font-size: 22px;
      font-weight: 800;
      color: #111827;
    }

    .subtitle {
      font-size: 13px;
      color: #6b7280;
      margin-bottom: 16px;
      white-space: pre-line;
    }

    /* 상단 단계 표시 */
    .flow-steps {
      display: flex;
      gap: 12px;
      margin-bottom: 18px;
      font-size: 12px;
    }

    .flow-step {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 8px;
      color: #9ca3af;
    }

    .flow-dot {
      width: 18px;
      height: 18px;
      border-radius: 999px;
      border: 2px solid #d1d5db;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      background: #ffffff;
    }

    .flow-label {
      white-space: nowrap;
    }

    .flow-step.active .flow-dot {
      border-color: #4f46e5;
      background: #eef2ff;
      color: #4f46e5;
    }
    .flow-step.active {
      color: #4f46e5;
      font-weight: 600;
    }

    .flow-step.done .flow-dot {
      border-color: #22c55e;
      background: #dcfce7;
      color: #15803d;
    }
    .flow-step.done {
      color: #16a34a;
      font-weight: 600;
    }

    .section-title {
      font-size: 15px;
      font-weight: 700;
      margin: 6px 0 8px;
      color: #111827;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .section-title span.badge {
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 999px;
      background: #eef2ff;
      color: #4338ca;
    }

    .helper {
      font-size: 12px;
      color: #6b7280;
      margin: 6px 0 0;
      white-space: pre-line;
    }

    iframe {
      width: 100%;
      border-radius: 10px;
      border: 1px solid #e5e7eb;
      background: #f9fafb;
    }

    .iframe-guide { height: 520px; }
    .iframe-test { height: 640px; }

    .btn-row {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-top: 10px;
      flex-wrap: wrap;
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 8px 14px;
      font-size: 13px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
      transition: all 0.15s ease;
    }

    .btn-primary {
      background: #4f46e5;
      color: #ffffff;
      font-weight: 600;
    }
    .btn-primary:hover {
      background: #4338ca;
      box-shadow: 0 6px 14px rgba(79, 70, 229, 0.3);
      transform: translateY(-1px);
    }

    .btn-secondary {
      background: #e5e7eb;
      color: #111827;
      font-weight: 500;
    }
    .btn-secondary:hover {
      background: #d1d5db;
    }

    .divider {
      height: 1px;
      background: #e5e7eb;
      margin: 18px 0 14px;
    }

    .flow-section { display: none; }
    .flow-section.active { display: block; }

    @media (max-width: 880px) {
      .page {
        margin: 12px auto 24px;
        padding: 14px 14px 18px;
      }
      .flow-steps {
        flex-direction: column;
        gap: 6px;
      }
      .iframe-guide,
      .iframe-test {
        height: 520px;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <h1>신규 프리랜서 작가 모집 안내</h1>
    <div class="subtitle">
안내문 확인 → TEST 작성·제출  
두 단계만 진행하시면 됩니다. (합격자 등록 단계는 개별 안내 링크로 별도 진행)
    </div>

    <!-- 상단 단계 표시: 1~2단계만 -->
    <div class="flow-steps">
      <div class="flow-step active" id="nav-step-1">
        <div class="flow-dot">1</div>
        <div class="flow-label">TEST 안내문</div>
      </div>
      <div class="flow-step" id="nav-step-2">
        <div class="flow-dot">2</div>
        <div class="flow-label">신규 작가 TEST</div>
      </div>
    </div>

    <!-- 1단계: 안내문 -->
    <section id="guide-section" class="flow-section active">
      <div class="section-title">
        TEST 안내문
        <span class="badge">test안내문&test자료.html</span>
      </div>
      <p class="helper">
우선 아래 안내문을 끝까지 읽어 주세요.  
TEST 진행 방식, 기본 규칙, 자주 묻는 질문이 정리되어 있습니다.
      </p>

      <iframe
        class="iframe-guide"
        src="test안내문&test자료.html"
        title="프리랜서 TEST 안내문"
      ></iframe>

      <div class="btn-row">
        <button type="button" class="btn-secondary" onclick="reloadGuide()">
          안내문 새로고침
        </button>
        <button type="button" class="btn-primary" onclick="goToStep(2)">
          TEST 안내 확인 & 시작하기
        </button>
      </div>
    </section>

    <div class="divider"></div>

    <!-- 2단계: TEST -->
    <section id="test-section" class="flow-section">
      <div class="section-title">
        신규 작가 TEST 작성
        <span class="badge">신규작가test.html</span>
      </div>
      <p class="helper">
아래 화면에서 TEST 제목·내용을 직접 작성하시고,  
해당 페이지 하단의 제출 버튼으로 마감 시간 전까지 제출해 주세요.
(합격자 등록 페이지 링크는 합격 통보 시 별도로 안내됩니다.)
      </p>

      <iframe
        class="iframe-test"
        src="신규작가test.html"
        title="신규 작가 TEST"
      ></iframe>

      <div class="btn-row">
        <button type="button" class="btn-secondary" onclick="goToStep(1)">
          안내문 다시 보기
        </button>
      </div>
    </section>
  </div>

  <script>
    function setNavStep(step) {
      const navIds = ["nav-step-1", "nav-step-2"];
      navIds.forEach((id, index) => {
        const el = document.getElementById(id);
        if (!el) return;
        el.classList.remove("active", "done");
        if (index + 1 === step) {
          el.classList.add("active");
        } else if (index + 1 < step) {
          el.classList.add("done");
        }
      });
    }

    function hideAllSections() {
      ["guide-section", "test-section"].forEach((id) => {
        const el = document.getElementById(id);
        if (el) el.classList.remove("active");
      });
    }

    function goToStep(step) {
      hideAllSections();

      if (step === 1) {
        document.getElementById("guide-section").classList.add("active");
        setNavStep(1);
      } else if (step === 2) {
        document.getElementById("test-section").classList.add("active");
        setNavStep(2);
      }
    }

    function reloadGuide() {
      const frame = document.querySelector(".iframe-guide");
      if (frame && frame.contentWindow) {
        frame.contentWindow.location.reload();
      }
    }

    // ★ TEST 열림/마감 상태에 따라 첫 화면을 완전히 잠그는 로직
    document.addEventListener("DOMContentLoaded", async function () {
      try {
        const res = await fetch("/api/writer-test/config");
        const data = await res.json();

        // 응답이 없거나 test_open이 false면: 안내문/TEST 전체를 막고 마감 안내만 노출
        if (!res.ok || !data || !data.test_open) {
          document.body.innerHTML = `
            <div style="
              min-height:100vh;
              display:flex;
              align-items:center;
              justify-content:center;
              background:#f9fafb;
              margin:0;
              padding:16px;
              font-family:-apple-system,BlinkMacSystemFont,'Segoe UI','Noto Sans KR',sans-serif;
            ">
              <div style="
                max-width:520px;
                width:100%;
                padding:32px 28px;
                border-radius:16px;
                background:#ffffff;
                box-shadow:0 12px 30px rgba(15,23,42,0.16);
                text-align:center;
              ">
                <h1 style="font-size:22px;margin-bottom:12px;color:#111827;">
                  신규 프리랜서 작가 TEST 모집이 종료되었습니다.
                </h1>
                <p style="font-size:14px;color:#4b5563;line-height:1.6;margin-bottom:14px;">
                  현재 진행 중인 모집이 마감되어<br />
                  TEST 안내문과 원고 작성은 더 이상 진행하실 수 없습니다.<br /><br />
                  추후 재모집 안내가 있을 경우 다시 지원 부탁드립니다.
                </p>
                <p style="font-size:12px;color:#9ca3af;">
                  (이미 제출된 TEST는 담당자가 관리자 페이지에서 순차적으로 검수 중입니다.)
                </p>
              </div>
            </div>
          `;
          return;
        }
      } catch (e) {
        console.error("writer-test config load error on main page:", e);
        // 오류가 나도 보수적으로 막아두는 편이 안전하므로, 동일한 마감 안내를 노출
        document.body.innerHTML = `
          <div style="
            min-height:100vh;
            display:flex;
            align-items:center;
            justify-content:center;
            background:#f9fafb;
            margin:0;
            padding:16px;
            font-family:-apple-system,BlinkMacSystemFont,'Segoe UI','Noto Sans KR',sans-serif;
          ">
            <div style="
              max-width:520px;
              width:100%;
              padding:32px 28px;
              border-radius:16px;
              background:#ffffff;
              box-shadow:0 12px 30px rgba(15,23,42,0.16);
              text-align:center;
            ">
              <h1 style="font-size:22px;margin-bottom:12px;color:#111827;">
                신규 프리랜서 작가 TEST 설정을 확인할 수 없습니다.
              </h1>
              <p style="font-size:14px;color:#4b5563;line-height:1.6;margin-bottom:14px;">
                TEST 상태 확인 중 오류가 발생했습니다.<br />
                잠시 후 페이지를 새로고침해 다시 접속해 주세요.
              </p>
            </div>
          </div>
        `;
        return;
      }

      // 여기까지 왔으면 test_open=true → 기존처럼 1단계(안내문) 활성화
      goToStep(1);
    });
  </script>
</body>
</html>
