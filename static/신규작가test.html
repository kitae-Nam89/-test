<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>í”„ë¦¬ëœì„œ ì‘ê°€ TEST | ì•ˆë‚´ ~ ì‘ì„± ~ ê²°ê³¼ ëŒ€ê¸°</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
        "Noto Sans KR", sans-serif;
    }

    body {
      margin: 0;
      background: #f3f4f6;
      color: #111827;
    }

    .page {
      max-width: 1100px;
      margin: 20px auto 40px;
      background: #ffffff;
      border-radius: 10px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.08);
      padding: 24px 28px 32px;
    }

    h1 {
      margin: 0 0 4px;
      font-size: 22px;
      font-weight: 700;
      color: #111827;
    }

    .subtitle {
      font-size: 13px;
      color: #6b7280;
      margin-bottom: 16px;
    }

    .section-title {
      font-weight: 600;
      font-size: 15px;
      margin: 16px 0 8px;
      color: #111827;
    }

    label {
      display: block;
      font-size: 13px;
      margin-bottom: 4px;
      color: #374151;
    }

    input[type="text"],
    select {
      width: 100%;
      padding: 8px 10px;
      border-radius: 6px;
      border: 1px solid #d1d5db;
      font-size: 13px;
      outline: none;
    }

    input[type="text"]:focus,
    select:focus {
      border-color: #6366f1;
      box-shadow: 0 0 0 1px rgba(99,102,241,0.3);
    }

    .row {
      display: flex;
      gap: 12px;
    }

    .row .col {
      flex: 1;
    }

    .checkbox-row {
      display: flex;
      align-items: flex-start;
      gap: 6px;
      margin-top: 10px;
      font-size: 12px;
      color: #4b5563;
    }

    .checkbox-row input[type="checkbox"] {
      margin-top: 2px;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 8px 14px;
      border-radius: 999px;
      border: none;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.16s ease;
      gap: 6px;
    }

    .btn-primary {
      background: #4f46e5;
      color: #ffffff;
    }
    .btn-primary:hover {
      background: #4338ca;
      transform: translateY(-1px);
      box-shadow: 0 6px 12px rgba(79,70,229,0.3);
    }

    .btn-secondary {
      background: #e5e7eb;
      color: #111827;
    }
    .btn-secondary:hover {
      background: #d1d5db;
    }

    .btn-sm {
      padding: 4px 10px;
      font-size: 12px;
      border-radius: 999px;
    }

    .helper-text {
      font-size: 11px;
      color: #9ca3af;
    }

    .divider {
      height: 1px;
      background: #e5e7eb;
      margin: 16px 0;
    }

    .highlight-box {
      background: #f9fafb;
      border-radius: 8px;
      border: 1px dashed #e5e7eb;
      padding: 10px 12px;
      font-size: 12px;
      color: #4b5563;
      line-height: 1.5;
    }

    .highlight-box strong {
      color: #111827;
    }

    /* ì§„í–‰ ë‹¨ê³„ í‘œì‹œ */
    .steps {
      display: flex;
      gap: 12px;
      margin-bottom: 14px;
      margin-top: 4px;
      font-size: 12px;
    }

    .step-item {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 6px;
      color: #9ca3af;
    }

    .step-circle {
      width: 18px;
      height: 18px;
      border-radius: 999px;
      border: 2px solid #d1d5db;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      background: #ffffff;
    }

    .step-label {
      white-space: nowrap;
    }

    .step-item.active .step-circle {
      border-color: #4f46e5;
      background: #eef2ff;
      color: #4f46e5;
    }
    .step-item.active {
      color: #4f46e5;
      font-weight: 600;
    }

    .step-item.done .step-circle {
      border-color: #22c55e;
      background: #dcfce7;
      color: #15803d;
    }
    .step-item.done {
      color: #16a34a;
    }

    /* TEST ë ˆì´ì•„ì›ƒ */
    .test-layout {
      display: flex;
      gap: 18px;
      margin-top: 14px;
    }

    .guide-pane {
      flex: 0 0 36%;
      border-radius: 10px;
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      padding: 12px 14px;
      font-size: 12px;
      color: #4b5563;
      max-height: 560px;
      overflow-y: auto;
    }

    .guide-pane h3 {
      margin-top: 0;
      margin-bottom: 8px;
      font-size: 13px;
      font-weight: 700;
      color: #111827;
    }

    .guide-pane h4 {
      margin: 10px 0 4px;
      font-size: 12px;
      font-weight: 600;
      color: #111827;
    }

    .guide-pane ul {
      padding-left: 18px;
      margin: 4px 0 6px;
    }

    .guide-pane li {
      margin-bottom: 2px;
    }

    .editor-pane {
      flex: 1;
      border-radius: 10px;
      border: 1px solid #e5e7eb;
      background: #ffffff;
      padding: 12px 14px 10px;
      display: flex;
      flex-direction: column;
      max-height: 560px;
    }

    .editor-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 8px;
      margin-bottom: 6px;
    }

    .timer-badge {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      background: #f97316;
      color: #fff;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .timer-badge.safe {
      background: #16a34a;
    }

    .timer-badge.danger {
      background: #dc2626;
    }

    .status-chip {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      color: #4b5563;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .status-chip.done {
      border-color: #16a34a;
      color: #16a34a;
    }

    .editor-title-input {
      width: 100%;
      padding: 7px 9px;
      border-radius: 6px;
      border: 1px solid #d1d5db;
      font-size: 13px;
      margin-bottom: 6px;
    }

    .editor-title-input:focus {
      border-color: #6366f1;
      box-shadow: 0 0 0 1px rgba(99,102,241,0.3);
      outline: none;
    }

    .editor-textarea {
      flex: 1;
      width: 100%;
      resize: none;
      border-radius: 6px;
      border: 1px solid #e5e7eb;
      font-size: 13px;
      padding: 8px 10px;
      line-height: 1.6;
      outline: none;
    }

    .editor-textarea:focus {
      border-color: #6366f1;
      box-shadow: 0 0 0 1px rgba(99,102,241,0.2);
    }

    .editor-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 6px;
      font-size: 11px;
      color: #6b7280;
      gap: 8px;
    }

    .editor-footer .left {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .editor-footer .right {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .char-count {
      font-weight: 500;
    }

    .alert {
      border-radius: 8px;
      padding: 8px 10px;
      font-size: 12px;
      margin-top: 10px;
    }

    .alert-warning {
      background: #fffbeb;
      border: 1px solid #facc15;
      color: #92400e;
    }

    .alert-success {
      background: #ecfdf3;
      border: 1px solid #22c55e;
      color: #166534;
    }

    .alert-error {
      background: #fef2f2;
      border: 1px solid #f97373;
      color: #991b1b;
    }

    /* ê²°ê³¼ëŒ€ê¸° í™”ë©´ ì „ìš© ë°•ìŠ¤ */
    .result-box {
      border-radius: 8px;
      padding: 10px 12px;
      font-size: 12px;
      margin-top: 8px;
      line-height: 1.6;
    }
    .result-wait {
      background:#eff6ff;
      border:1px solid #bfdbfe;
      color:#1d4ed8;
    }
    .result-pass {
      background:#ecfdf3;
      border:1px solid #22c55e;
      color:#166534;
    }
    .result-fail {
      background:#fef2f2;
      border:1px solid #fecaca;
      color:#b91c1c;
    }

    .result-return {
      background:#fefce8;
      border:1px solid #facc15;
      color:#92400e;
    }

    /* ëª¨ë‹¬ */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15,23,42,0.55);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 999;
    }

    .modal {
      background: #ffffff;
      border-radius: 12px;
      padding: 16px 18px 14px;
      max-width: 380px;
      width: calc(100% - 32px);
      box-shadow: 0 18px 40px rgba(0,0,0,0.3);
      animation: pop 0.14s ease-out;
    }

    @keyframes pop {
      from { transform: scale(0.96) translateY(6px); opacity: 0; }
      to { transform: scale(1) translateY(0); opacity: 1; }
    }

    .modal-title {
      font-size: 15px;
      font-weight: 700;
      margin-bottom: 6px;
      color: #111827;
    }

    .modal-body {
      font-size: 12px;
      color: #4b5563;
      margin-bottom: 12px;
      line-height: 1.6;
    }

    .modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
    }

    .result-wait-box {
      margin-top: 12px;
      padding: 10px 12px;
      border-radius: 8px;
      background: #eff6ff;
      border: 1px solid #bfdbfe;
      font-size: 12px;
      color: #1d4ed8;
      display: none;
    }

    @media (max-width: 880px) {
      .test-layout {
        flex-direction: column;
      }
      .guide-pane {
        max-height: 260px;
      }
      .editor-pane {
        max-height: 400px;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <h1>í”„ë¦¬ëœì„œ ì‘ê°€ TEST</h1>
    <div class="subtitle">
      ì§€ì›ì ê¸°ë³¸ì •ë³´ ì…ë ¥ â†’ TEST ì•ˆë‚´ í™•ì¸ â†’ ì›ê³  ì‘ì„± â†’ ì œì¶œ í›„ ê²°ê³¼ ëŒ€ê¸°ê¹Œì§€ í•œ í™”ë©´ì—ì„œ ì§„í–‰ë©ë‹ˆë‹¤.
    </div>

    <!-- ë‹¨ê³„ í‘œì‹œ -->
    <div class="steps">
      <div class="step-item active" id="step-1">
        <div class="step-circle">1</div>
        <div class="step-label">ì•ˆë‚´ í™•ì¸ & ì •ë³´ ì…ë ¥</div>
      </div>
      <div class="step-item" id="step-2">
        <div class="step-circle">2</div>
        <div class="step-label">TEST ì‘ì„±</div>
      </div>
      <div class="step-item" id="step-3">
        <div class="step-circle">3</div>
        <div class="step-label">ì œì¶œ ì™„ë£Œ & ê²°ê³¼ ëŒ€ê¸°</div>
      </div>
    </div>

    <!-- STEP1 -->
    <section id="applicant-section">
      <div class="section-title">1. ì§€ì›ì ê¸°ë³¸ ì •ë³´</div>
      <div class="highlight-box">
        <strong>â€» ê°œì¸ì •ë³´ ìˆ˜ì§‘ ëª©ì  ì•ˆë‚´</strong><br />
        - ì•„ë˜ ì •ë³´ëŠ” TEST ì‘ì‹œì ì‹ë³„ ë° ì¤‘ë³µ ì§€ì› ì´ë ¥ í™•ì¸ì„ ìœ„í•´ ì‚¬ìš©ë©ë‹ˆë‹¤.<br />
        - ì„¸ë¬´Â·ì •ì‚°ì„ ìœ„í•œ ì£¼ë¯¼ë²ˆí˜¸ ë° ê³„ì¢Œì •ë³´ëŠ” <strong>í•©ê²© í›„ ê³„ì•½ ë‹¨ê³„</strong>ì—ì„œ ë³„ë„ ì•ˆë‚´ í˜ì´ì§€ë¥¼ í†µí•´ ë°›ìŠµë‹ˆë‹¤.
      </div>

      <div style="margin-top: 12px; display: flex; flex-direction: column; gap: 10px;">
        <div class="row">
          <div class="col">
            <label for="name-input">ì´ë¦„</label>
            <input id="name-input" type="text" placeholder="ì‹¤ëª… ê¸°ì¤€ìœ¼ë¡œ ì…ë ¥í•´ ì£¼ì„¸ìš”" />
          </div>
          <div class="col">
            <label for="birthyear-select">ì¶œìƒì—°ë„</label>
            <select id="birthyear-select">
              <option value="">ì„ íƒí•´ ì£¼ì„¸ìš”</option>
            </select>
            <div class="helper-text">ì˜ˆ: 1992ë…„ìƒ â†’ 1992 ì„ íƒ</div>
          </div>
        </div>

        <div class="row">
          <div class="col">
            <label for="phone-last4-input">íœ´ëŒ€í° ë²ˆí˜¸ ë’·ìë¦¬ 4ìë¦¬</label>
            <input id="phone-last4-input" type="text" maxlength="4" placeholder="ì˜ˆ: 4821" />
            <div class="helper-text">
              ì¤‘ë³µ ì§€ì› í™•ì¸ ë° ë³¸ì¸ í™•ì¸ ìš©ë„ë¡œë§Œ ì‚¬ìš©ë©ë‹ˆë‹¤.
            </div>
          </div>
        </div>

        <div class="checkbox-row">
          <input type="checkbox" id="info-consent-checkbox" />
          <label for="info-consent-checkbox">
            ìœ„ ì •ë³´ëŠ” TEST ì‘ì‹œ í™•ì¸ ë° ì¤‘ë³µì§€ì› ë°©ì§€ ëª©ì ì— í•œí•´ ì‚¬ìš©ë˜ë©°,
            ì±„ìš© ì ˆì°¨ ì¢…ë£Œ í›„ ì¼ì • ê¸°ê°„ ë‚´ íŒŒê¸°ë¨ì— ë™ì˜í•©ë‹ˆë‹¤.
          </label>
        </div>
      </div>

      <div class="divider"></div>

      <div class="section-title">2. TEST ì•ˆë‚´ ìš”ì•½</div>
      <div class="highlight-box">
        <strong>â€» ì‹¤ì œ TEST ì•ˆë‚´ë¬¸ & ìë£ŒëŠ” ì•„ë˜ TEST í™”ë©´ ì™¼ìª½ íŒ¨ë„ì—ì„œ ë‹¤ì‹œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</strong><br />
        - AI ìë™ ì‘ì„±, ê¸°ì¡´ ì›ê³  ì¬ì‚¬ìš©, ì¸í„°ë„·ì—ì„œ ê·¸ëŒ€ë¡œ ê°€ì ¸ì˜¨ ê¸€ì€ <strong>ì¦‰ì‹œ íƒˆë½</strong> ì²˜ë¦¬ë©ë‹ˆë‹¤.<br />
        - ê¸€ì˜ êµ¬ì„±, ë¬¸ì¥ë ¥, ë…ì ê´€ì ì—ì„œì˜ ì´í•´ë„, ê°€ë…ì„±ì„ ì¤‘ì‹¬ìœ¼ë¡œ í‰ê°€í•©ë‹ˆë‹¤.<br />
        - <strong>TEST ì‹œì‘ ë²„íŠ¼ì„ ëˆ„ë¥´ëŠ” ìˆœê°„ë¶€í„° ìµì¼ ì˜¤í›„ 1ì‹œê¹Œì§€</strong> ì œì¶œ ì‹œê°„ì´ ë¶€ì—¬ë©ë‹ˆë‹¤.
      </div>

      <div style="margin-top: 12px; display: flex; justify-content: space-between; align-items: center; gap: 10px;">
        <div class="helper-text">
          â€» TEST ì‹œì‘ í›„ì—ëŠ” ë§ˆê° ì‹œê°„ì´ ìë™ ì„¤ì •ë˜ë©°, ë§ˆê° ì´í›„ì—ëŠ” ì œì¶œì´ ë¶ˆê°€í•©ë‹ˆë‹¤.
        </div>
        <button class="btn btn-primary" id="open-warning-btn">
          TEST ì•ˆë‚´ í™•ì¸ &amp; ì‹œì‘í•˜ê¸°
        </button>
      </div>

      <div class="alert alert-error" id="error-alert" style="display:none; margin-top:10px;"></div>
    </section>

    <!-- STEP2 : TEST ì‘ì„± -->
    <section id="test-section" style="display:none;">
      <div class="section-title" style="display: flex; justify-content: space-between; align-items: center;">
        <span>3. TEST ì›ê³  ì‘ì„±</span>
        <span id="applicant-summary" style="font-size:11px; color:#6b7280;"></span>
      </div>

      <div class="alert alert-warning" id="deadline-alert">
        TEST ì‹œì‘ ì‹œì  ê¸°ì¤€ìœ¼ë¡œ <strong>ìµì¼ ì˜¤í›„ 1ì‹œê¹Œì§€</strong> ì œì¶œí•´ì•¼ í•©ë‹ˆë‹¤.
        ë§ˆê° ì‹œì  ì´í›„ì—ëŠ” ì œì¶œ ë²„íŠ¼ì´ ë¹„í™œì„±í™”ë©ë‹ˆë‹¤.
      </div>
      <div class="alert alert-success" id="submit-alert" style="display:none;">
        TEST ì›ê³ ê°€ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹´ë‹¹ìê°€ ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ê²€ìˆ˜ í›„ í•©ê²© ì—¬ë¶€ë¥¼ ê²°ì •í•©ë‹ˆë‹¤.
      </div>

      <div class="test-layout">
        <!-- ì™¼ìª½: ì•ˆë‚´ -->
        <aside class="guide-pane">
          <h3>ì´ë²ˆ TEST ì¡°ê±´ & ì‘ì„± ê°€ì´ë“œ</h3>

          <p style="margin-bottom:6px;">
            ì•„ë˜ ë‚´ìš©ì€ <strong>ì´ë²ˆ ëª¨ì§‘ ê³µê³ ì—ë§Œ ì ìš©ë˜ëŠ” TEST ì¡°ê±´</strong>ì…ë‹ˆë‹¤.
            ì˜¤ë¥¸ìª½ ì‘ì„±ì°½ì—ì„œ ì›ê³ ë¥¼ ì“°ì‹¤ ë•Œ, ë°˜ë“œì‹œ ì´ ì¡°ê±´ì„ ê¸°ì¤€ìœ¼ë¡œ ë§ì¶° ì£¼ì„¸ìš”.
          </p>

          <h4>1) TEST ê¸°ë³¸ ì¡°ê±´</h4>
          <ul>
            <li>ê¸€ì ìˆ˜: <span class="highlight">ê³µë°± ì œì™¸ 2,000ì</span></li>
            <li>í‚¤ì›Œë“œ: <span class="highlight">í‚¤ ì˜ì–‘ì œ</span></li>
            <li>
              í‚¤ì›Œë“œ íšŸìˆ˜:
              <span class="highlight">ì œëª© í¬í•¨ ì´ 6íšŒ</span><br />
              (ì²« ë‹¨ë½ 1íšŒ / ë ë‹¨ë½ 1íšŒ í•„ìˆ˜, ë‚˜ë¨¸ì§€ 4íšŒëŠ” ì¤‘ê°„ ë‹¨ë½ ë¶„ì‚°)
            </li>
            <li>ì œëª© êµ¬ì„±: <span class="highlight">[í‚¤ ì˜ì–‘ì œ] + ì‹¤ì œ í›„ê¸° ëŠë‚Œì˜ ë¬¸ì¥</span></li>
            <li>ë³¸ë¬¸ í†¤: ì‹¤ì œ ì‚¬ìš© í›„ê¸° 7í•  + ì •ë³´Â·ì„¤ëª… 3í•  ì •ë„</li>
          </ul>

          <h4>2) ì–‘ì‹ ê°€ì´ë“œ (í•µì‹¬ 10ê°€ì§€)</h4>
          <ul>
            <li>ì„±ë¶„Â·íš¨ê³¼ í™•ì • í‘œí˜„(100%, ë³´ì¥ ë“±) ì‚¬ìš© ê¸ˆì§€</li>
            <li>ì œëª©ì— ì œí’ˆëª… ì§ì ‘ ì‘ì„± ê¸ˆì§€</li>
            <li>ì²«Â·ë ë‹¨ë½ì— í‚¤ì›Œë“œ 1íšŒì”© í•„ìˆ˜</li>
            <li>ì •ë³´ ì„¤ëª…ë³´ë‹¤ ì‹¤ì œ ì‚¬ìš© í›„ê¸° ë¹„ì¤‘ì´ ë” í¬ë„ë¡ ì‘ì„±</li>
            <li>ì—…ì²´ëª…ì€ 1~2íšŒë§Œ ì–¸ê¸‰</li>
            <li>í‚¤ì›Œë“œëŠ” í•­ìƒ ì¢Œì¸¡ ê³ ì •ìœ¼ë¡œ ì‘ì„±</li>
            <li>í‚¤ì›Œë“œ ë’¤ì— ì¡°ì‚¬(ì€/ëŠ”/ì´/ê°€ ë“±) ë¶™ì´ì§€ ì•Šê¸°</li>
            <li>ë¹„ìŠ·í•œ ë¬¸êµ¬Â·ë‚´ìš© ë°˜ë³µ ì‘ì„± ê¸ˆì§€</li>
            <li>ë‘ë£¨ë­‰ì‹¤í•œ í‘œí˜„ë³´ë‹¤ êµ¬ì²´ì ì¸ ê²½í—˜ ìœ„ì£¼ë¡œ ì‘ì„±</li>
            <li>ê³¼ë„í•œ ê³¼ì¥Â·í™•ì • í‘œí˜„ ê¸ˆì§€</li>
          </ul>

          <h4>3) ë¶„ëŸ‰ & í˜•ì‹</h4>
          <ul>
            <li>ì œëª© 1ì¤„ + ë³¸ë¬¸ ê¸°ë³¸ 1,200ì ì´ìƒ</li>
            <li>ë¬¸ë‹¨ì„ ì ì ˆíˆ ë‚˜ëˆ„ê³ , ë„ˆë¬´ ê¸´ ë¬¸ì¥ì€ 2ë¬¸ì¥ ì´ìƒìœ¼ë¡œ ë‚˜ëˆ„ê¸°</li>
          </ul>

          <h4>4) í‰ê°€ ê¸°ì¤€ (ì˜ˆì‹œ)</h4>
          <ul>
            <li>ë¬¸ì¥ë ¥ / êµ¬ì„± / ë…ì ê´€ì  / ì„±ì˜ë„</li>
          </ul>

          <h4>5) TEST ì‹œê°„</h4>
          <ul>
            <li>TEST ì‹œì‘ ë²„íŠ¼ í´ë¦­ ì‹œì  ê¸°ì¤€ìœ¼ë¡œ ìµì¼ ì˜¤í›„ 1ì‹œê¹Œì§€ ì œì¶œ</li>
            <li>ë§ˆê° ì‹œê°„ ì´í›„ì—ëŠ” ì œì¶œ ë²„íŠ¼ì´ ë¹„í™œì„±í™”ë©ë‹ˆë‹¤.</li>
          </ul>

          <p style="margin-top:10px; font-size:11px; color:#9ca3af;">
            â€» ì‹¤ì œ ìš´ì˜ ì‹œì—ëŠ” ì´ ì˜ì—­ì— ì§€ê¸ˆê¹Œì§€ ì‚¬ìš©í•˜ë˜ TEST ì•ˆë‚´ë¬¸ê³¼ ì˜ˆì‹œë¥¼ ê·¸ëŒ€ë¡œ ë¶™ì—¬ ë„£ìœ¼ë©´ ë©ë‹ˆë‹¤.
          </p>
        </aside>

        <!-- ì˜¤ë¥¸ìª½: ì—ë””í„° -->
        <section class="editor-pane">
          <div class="editor-header">
            <div>
              <input
                id="test-title-input"
                class="editor-title-input"
                type="text"
                placeholder="ì œëª©ì„ ì…ë ¥í•´ ì£¼ì„¸ìš” (í•„ìˆ˜)"
              />
              <div style="margin-top:2px;">
                <span style="font-size:11px; color:#9ca3af;">â€» ì‹¤ì „ ì‘ì—… ê¸°ì¤€ìœ¼ë¡œ í‰ê°€ë©ë‹ˆë‹¤.</span>
              </div>
            </div>
            <div style="text-align:right;">
              <div id="timer-badge" class="timer-badge safe">
                â± <span id="timer-text">ìµì¼ ì˜¤í›„ 1ì‹œ ë§ˆê° </span>
              </div>
              <div style="margin-top:4px;">
                <span id="submit-status" class="status-chip">ì œì¶œ ì „</span>
              </div>
            </div>
          </div>

          <textarea
            id="test-body-textarea"
            class="editor-textarea"
            placeholder="ì—¬ê¸°ì— TEST ì›ê³ ë¥¼ ì‘ì„±í•´ ì£¼ì„¸ìš”.&#10;&#10;â€» ì„ì‹œì €ì¥ í›„ì—ë„ ë§ˆê° ì‹œê°„ ì „ê¹Œì§€ëŠ” ë‹¤ì‹œ ìˆ˜ì •Â·ì €ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
          ></textarea>

          <div class="editor-footer">
            <div class="left">
              <span>ê¸€ì ìˆ˜ (ë‹¨ìˆœ ë¬¸ì ìˆ˜ ê¸°ì¤€)</span>
              <span id="char-count" class="char-count">0ì</span>
            </div>
<div class="right">
  <button type="button" class="btn btn-secondary btn-sm" id="save-draft-btn">
    ì„ì‹œì €ì¥
  </button>
  <button type="button" class="btn btn-secondary btn-sm" id="download-txt-btn">
    PCì— TXTë¡œ ì €ì¥
  </button>
  <button type="button" class="btn btn-primary btn-sm" id="submit-test-btn">
    ìµœì¢… ì œì¶œ
  </button>
  <button type="button" class="btn btn-secondary btn-sm" id="view-result-btn" style="display:none;">
    ê²°ê³¼ ë³´ê¸°
  </button>
</div>
          </div>

          <!-- STEP2 ë‚´ë¶€ ê°„ë‹¨ ì•ˆë‚´ -->
          <div class="result-wait-box" id="result-wait-box">
            TEST ì›ê³ ê°€ ì •ìƒì ìœ¼ë¡œ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤.<br />
            ë‹´ë‹¹ìê°€ <strong>ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ìˆœì°¨ì ìœ¼ë¡œ ê²€ìˆ˜</strong>í•œ ë’¤,<br />
            í•©ê²© / ë¶ˆí•©ê²© ê²°ê³¼ì™€ ë‹¤ìŒ ì•ˆë‚´ë¥¼ ì •ë¦¬í•˜ì—¬ ë“œë¦½ë‹ˆë‹¤.
          </div>
        </section>
      </div>
    </section>

    <!-- STEP3 : ì œì¶œ ì™„ë£Œ & ê²°ê³¼ ëŒ€ê¸° / í•©ê²© / ë¶ˆí•©ê²© -->
    <section id="result-section" style="display:none; margin-top:18px;">
      <div class="section-title">3. ì œì¶œ ì™„ë£Œ & ê²°ê³¼ ëŒ€ê¸°</div>

      <!-- 1) ê¸°ë³¸: ê²°ê³¼ ëŒ€ê¸° -->
      <div id="result-waiting" class="result-box result-wait">
        <strong>TEST ê²°ê³¼ë¥¼ ê¸°ë‹¤ë¦¬ê³  ìˆìŠµë‹ˆë‹¤.</strong><br />
        ë‹´ë‹¹ìê°€ ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ìˆœì°¨ì ìœ¼ë¡œ ê²€ìˆ˜í•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤.<br />
        í•©ê²© ì—¬ë¶€ê°€ ê²°ì •ë˜ë©´, ê³µì§€ëœ ë°©ì‹ì— ë”°ë¼ ë³„ë„ë¡œ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.<br /><br />
        í•©ê²© í†µë³´ë¥¼ ë°›ìœ¼ì‹  ë’¤ì—ëŠ” <strong>ì•„ë˜ ë²„íŠ¼ì´ í™œì„±í™”</strong>ë˜ë©°,<br />
        ê·¸ë•Œ <strong>â€œì‹ ê·œ ì‘ê°€ ë“±ë¡í•˜ê¸°â€ ë²„íŠ¼</strong>ì„ ëˆŒëŸ¬ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì´ë™í•˜ì‹œë©´ ë©ë‹ˆë‹¤.
      </div>

      <!-- 1-1) ë°˜ë ¤(ìˆ˜ì • ìš”ì²­) ìƒíƒœ -->
      <div id="result-return" class="result-box result-return" style="display:none;">
        <strong>TEST ìˆ˜ì • ìš”ì²­(ë°˜ë ¤) ìƒíƒœì…ë‹ˆë‹¤.</strong><br />
        ë‹´ë‹¹ìê°€ ì‘ì„±í•˜ì‹  ì›ê³ ë¥¼ ê²€í† í•œ ê²°ê³¼,<br />
        <strong>ì¼ë¶€ í‘œí˜„ ë³´ì™„ ë˜ëŠ” êµ¬ì„± ìˆ˜ì •ì´ í•„ìš”í•˜ë‹¤</strong>ê³  íŒë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤.<br /><br />
        ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ TEST ì‘ì„± í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€<br />
        ë‚´ìš©ì„ ìˆ˜ì •í•œ ë’¤ ë‹¤ì‹œ <strong>ìµœì¢… ì œì¶œ</strong>í•´ ì£¼ì„¸ìš”.<br /><br />
        <button type="button" class="btn btn-secondary btn-sm" id="btn-edit-again">
          TEST ë‹¤ì‹œ ìˆ˜ì •í•˜ê¸°
        </button>
      </div>

      <!-- 2) í•©ê²© ìƒíƒœ -->
      <div id="result-pass" class="result-box result-pass" style="display:none;">
        <strong>TEST í•©ê²©ì„ ì¶•í•˜ë“œë¦½ë‹ˆë‹¤!</strong><br />
        ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ <strong>ì‹ ê·œ ì‘ê°€ ë“±ë¡ í˜ì´ì§€</strong>ë¡œ ì´ë™í•´ ì£¼ì„¸ìš”.<br />
        ë“±ë¡ ë° ê³„ì•½ì„œ ì‘ì„± í›„, <strong>ìº¡ì²˜ ì´ë¯¸ì§€ë¥¼ ë‹´ë‹¹ì ì¹´ì¹´ì˜¤í†¡ìœ¼ë¡œ ì „ì†¡</strong>í•˜ë©´ ë“±ë¡ ì ˆì°¨ê°€ ì™„ë£Œë©ë‹ˆë‹¤.<br /><br />
        <button type="button" class="btn btn-primary btn-sm" id="btn-go-register">
          ì‹ ê·œ ì‘ê°€ ë“±ë¡í•˜ê¸° (ê³„ì•½ì„œ ì‘ì„± ë‹¨ê³„ë¡œ ì´ë™)
        </button>
      </div>

<!-- 3) ë¶ˆí•©ê²© ìƒíƒœ -->
<div id="result-fail" class="result-box result-fail" style="display:none;">
  <strong>ì•ˆíƒ€ê¹ê²Œë„ ì´ë²ˆ TESTì—ì„œëŠ” í•¨ê»˜í•˜ì§€ ëª»í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.</strong><br />
  ì•„ë˜ í•­ëª©ë“¤ì„ ì¢…í•©ì ìœ¼ë¡œ ê²€í† í•œ ê²°ê³¼,<br />
  ì´ë²ˆ ëª¨ì§‘ ë°©í–¥ê³¼ì˜ ì í•©ë„ê°€ ì¶©ë¶„í•˜ì§€ ì•Šë‹¤ê³  íŒë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤.<br /><br />

  <ul style="margin:4px 0 0 18px; padding-left:0; text-align:left;">
    <li>ê°€ì´ë“œ ë¯¸ì¤€ìˆ˜ / ì‘ì„± ê·œì¹™ ë° ì•ˆë‚´ì‚¬í•­ ë°˜ì˜ ë¶€ì¡±</li>
    <li>ì–‘ì‹ ë¯¸ì¤€ìˆ˜ / êµ¬ì„±Â·í˜•ì‹ ì¼ê´€ì„± ë¶€ì¡±</li>
    <li>ì •ë³´ ì „ë‹¬ë ¥ ì•½í•¨ / í•µì‹¬ ë‚´ìš©ì´ ì¶©ë¶„íˆ ë“œëŸ¬ë‚˜ì§€ ì•ŠìŒ</li>
    <li>ê¸°ìŠ¹ì „ê²° êµ¬ì¡° ë¶€ì¡± / ë¬¸ë‹¨ ì „ê°œ ë° íë¦„ ë¯¸í¡</li>
    <li>ë¶ˆí•„ìš”í•œ ë‚´ìš©ì´ ë§ìŒ / ì£¼ì œì™€ ì§ì ‘ ê´€ë ¨ë˜ì§€ ì•Šì€ ì„œìˆ  ê³¼ë‹¤</li>
    <li>ë¬´ì˜ë¯¸í•œ ê¸€ì ìˆ˜ ì±„ìš°ê¸° / ë°˜ë³µÂ·êµ°ë”ë”ê¸° í‘œí˜„ ë‹¤ìˆ˜</li>
    <li>ê³¼ë„í•œ ìƒí™© ì„¤ì • / ê³¼ì¥ëœ ê°€ìƒ ì„œìˆ  ë¹„ì¤‘ ê³¼ë‹¤</li>
    <li>ì›ê³  ì´í•´ë„ ë¶€ì¡± / ìë£Œ í•´ì„Â·ì£¼ì œ íŒŒì•… ë¯¸í¡</li>
    <li>í•„ë ¥ ë¶€ì¡± / ë¬¸ì¥ ì™„ì„±ë„Â·ê°€ë…ì„±Â·ì–´íœ˜ ìš´ìš© ë¯¸í¡</li>
    <li>í‚¤ì›Œë“œ ì´í•´ë„ ë¶€ì¡± / í‚¤ì›Œë“œ ì·¨ì§€Â·ë§¥ë½ ë°˜ì˜ ë¯¸í¡</li>
    <li>AI ìƒì„± ì›ê³  ì˜ì‹¬ íŒ¨í„´ ë°œê²¬ (ì¶”í›„ TEST ì œí•œ ê°€ëŠ¥)</li>
    <li>í‘œì ˆÂ·ê¸°ì¡´ ë¬¸ì„œ ì¬ì‚¬ìš© ì˜ì‹¬ ë¬¸ì„œ ë°œê²¬ (ì¶”í›„ TEST ì œí•œ ê°€ëŠ¥)</li>
    <li>TESTë§ˆê°ì‹œê°„ ë¯¸ì¤€ìˆ˜</li>
  </ul>

  <p style="margin-top:8px;">
    ìœ„ ê¸°ì¤€ì€ ì „ì²´ ì§€ì›ìì—ê²Œ ê³µí†µìœ¼ë¡œ ì ìš©ë˜ë©°,<br />
    ê°œë³„ ì‚¬ìœ ëŠ” ë³„ë„ë¡œ ì•ˆë‚´ë˜ì§€ ì•ŠëŠ” ì  ì–‘í•´ ë¶€íƒë“œë¦½ë‹ˆë‹¤.
  </p>

  <p style="margin-top:8px;">
    ì´í›„ ë³„ë„ ê³µê³ ê°€ ìˆì„ ê²½ìš°, ì•ˆë‚´ì— ë”°ë¼ ë‹¤ì‹œ ì§€ì›í•´ ì£¼ì…”ë„ ë©ë‹ˆë‹¤.
  </p>
</div>

      <p style="margin-top:14px; font-size:12px; color:#6b7280;">
        ì´ í˜ì´ì§€ëŠ” ë‹«ìœ¼ì…”ë„ ë©ë‹ˆë‹¤.  
        ì¶”í›„ ê²°ê³¼ ë° í•©ê²©ì ì•ˆë‚´ëŠ” ê³µì§€ëœ ë°©ì‹ì— ë”°ë¼ ë³„ë„ë¡œ ì „ë‹¬ë©ë‹ˆë‹¤.
      </p>
    </section>
  </div>

  <!-- ê²½ê³  ëª¨ë‹¬ -->
  <div class="modal-backdrop" id="warning-modal-backdrop">
    <div class="modal">
      <div class="modal-title">TEST ì‹œì‘ ì „ ìµœì¢… ì•ˆë‚´</div>
      <div class="modal-body">
        - TEST ì‹œì‘ ë²„íŠ¼ì„ ëˆ„ë¥´ëŠ” ì‹œì ë¶€í„° <strong>ìµì¼ ì˜¤í›„ 1ì‹œê¹Œì§€</strong> ì‘ì„± ë° ì œì¶œ ì‹œê°„ì„ ë¶€ì—¬í•©ë‹ˆë‹¤.<br />
        - ì¥ë‚œ ì§€ì›, í—ˆìœ„ì •ë³´ ê¸°ì¬, AI ìë™ ì‘ì„±, ê¸°ì¡´ ì›ê³  ì¬ì‚¬ìš©ì´ í™•ì¸ë  ê²½ìš°
        í–¥í›„ ëª¨ë“  ëª¨ì§‘ì—ì„œ ì œì™¸ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br /><br />
        ì´ ì•ˆë‚´ë¥¼ ëª¨ë‘ ì´í•´í–ˆê³ , <strong>ì‹¤ì œ ì‘ì—… ì˜ì‚¬ê°€ ìˆëŠ” ê²½ìš°ì—ë§Œ</strong> ê³„ì† ì§„í–‰í•´ ì£¼ì„¸ìš”.
      </div>
      <div class="modal-actions">
        <button type="button" class="btn btn-secondary btn-sm" id="warning-cancel-btn">
          ì·¨ì†Œ
        </button>
        <button type="button" class="btn btn-primary btn-sm" id="warning-confirm-btn">
          ë™ì˜í•˜ê³  TEST ì‹œì‘
        </button>
      </div>
    </div>
  </div>

<script>
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€ ì „ì—­ ìƒíƒœ â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let applicant = {
    name: "",
    birthYear: "",
    phoneLast4: ""
  };
  let testId = null;        // ì„œë²„ DBì— ì €ì¥ëœ TEST ID
  let deadline = null;      // ë§ˆê° ì‹œê°„ (Date ê°ì²´)
  let timerInterval = null;
  let submitted = false;
  let testStatus = "waiting"; // "waiting" | "pending" | "pass" | "fail" | "return"

  const STORAGE_KEY = "writer_test_draft_v1";

  const $ = (selector) => document.querySelector(selector);

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€ ê³µí†µ ìœ í‹¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function setStep(step) {
    const s1 = $("#step-1");
    const s2 = $("#step-2");
    const s3 = $("#step-3");

    [s1, s2, s3].forEach((el) => {
      el.classList.remove("active", "done");
    });

    if (step === 1) {
      s1.classList.add("active");
    } else if (step === 2) {
      s1.classList.add("done");
      s2.classList.add("active");
    } else if (step === 3) {
      s1.classList.add("done");
      s2.classList.add("done");
      s3.classList.add("active");
    }
  }

  function setText(id, text) {
    const el = document.getElementById(id);
    if (el) el.textContent = text;
  }

  function showError(msg) {
    const el = $("#error-alert");
    if (!el) return;
    el.textContent = msg;
    el.style.display = "block";
  }

  function clearError() {
    const el = $("#error-alert");
    if (!el) return;
    el.textContent = "";
    el.style.display = "none";
  }

  // ì œì¶œ ìƒíƒœ ë±ƒì§€ ì—…ë°ì´íŠ¸
  function updateSubmitStatusChip() {
    const chip = $("#submit-status");
    if (!chip) return;

    chip.classList.remove("done");

    if (!submitted) {
      chip.textContent = "ì œì¶œ ì „";
      return;
    }

    // ì œì¶œ ì™„ë£Œ ìƒíƒœ
    chip.classList.add("done");
    if (testStatus === "pass") {
      chip.textContent = "í•©ê²©";
    } else if (testStatus === "fail") {
      chip.textContent = "ë¶ˆí•©ê²©";
    } else if (testStatus === "return") {
      chip.textContent = "ë°˜ë ¤ - ìˆ˜ì • ê°€ëŠ¥";
    } else {
      chip.textContent = "ì œì¶œ ì™„ë£Œ";
    }
  }

  // ê³µë°± ì œì™¸ ê¸€ì ìˆ˜
  function getNonWhitespaceLength(text) {
    if (!text) return 0;
    return text.replace(/\s/g, "").length;
  }

  // ì¶œìƒì—°ë„ ì˜µì…˜ ì´ˆê¸°í™”
  (function initBirthYearOptions() {
    const select = $("#birthyear-select");
    if (!select) return;
    const now = new Date();
    const currentYear = now.getFullYear();
    const minYear = 1960;
    const maxYear = currentYear - 18;

    for (let y = maxYear; y >= minYear; y--) {
      const opt = document.createElement("option");
      opt.value = String(y);
      opt.textContent = y + "ë…„ìƒ";
      select.appendChild(opt);
    }
  })();

// â”€â”€â”€â”€â”€â”€â”€â”€â”€ íƒ€ì´ë¨¸ (ë¹„í™œì„±í™” ë²„ì „) â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ìˆ«ì ì¹´ìš´íŠ¸ë‹¤ìš´ì€ ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•Šê³ ,
// ë°°ì§€ì—ëŠ” ì•ˆë‚´ ë¬¸êµ¬ë§Œ ê³ ì •ìœ¼ë¡œ ë³´ì—¬ì¤€ë‹¤.

function startTimer() {
  // í˜¹ì‹œë¼ë„ ë‹¤ë¥¸ ê³³ì—ì„œ í˜¸ì¶œí•´ë„ ì•„ë¬´ ë™ì‘ ì•ˆ í•˜ë„ë¡ ì²˜ë¦¬
  const badge = document.getElementById("timer-badge");
  const text = document.getElementById("timer-text");

  if (badge) {
    badge.classList.remove("danger");
    badge.classList.add("safe");
  }
  if (text) {
    text.textContent = "ìµì¼ ì˜¤í›„ 1ì‹œ ë§ˆê°";
  }

  if (typeof timerInterval !== "undefined" && timerInterval) {
    clearInterval(timerInterval);
  }
  deadline = null;
}

// updateTimer / computeDeadlineFromNow ëŠ” ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì‚­ì œí•´ë„ ë¬´ë°©


  // â”€â”€â”€â”€â”€â”€â”€â”€â”€ í˜„ì¬ ì›ê³ ë¥¼ PCì— TXT íŒŒì¼ë¡œ ì €ì¥ â”€â”€â”€â”€â”€â”€â”€â”€â”€
function downloadTxtToPC() {
  const rawTitle = ($("#test-title-input").value || "").trim();
  const body = $("#test-body-textarea").value || "";

  if (!rawTitle && !body) {
    alert("ì €ì¥í•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.");
    return;
  }

  // íŒŒì¼ëª…ì€ ì œëª©ì´ ìˆìœ¼ë©´ ì œëª©, ì—†ìœ¼ë©´ writer_test
  const fileNameBase = (rawTitle || "writer_test").replace(/[\\/:*?"<>|]/g, "_");

  // ğŸ”´ TXT ì•ˆì—ëŠ” "ì œëª© â†’ ë¹ˆ ì¤„ â†’ ë³¸ë¬¸" êµ¬ì¡°ë¡œ ì €ì¥
  const text =
    (rawTitle ? rawTitle + "\n\n" : "") +
    body;

  const blob = new Blob([text], { type: "text/plain;charset=utf-8" });
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = fileNameBase + ".txt";
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);

  URL.revokeObjectURL(url);
}

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€ ì„ì‹œ ì €ì¥ (ë¸Œë¼ìš°ì € ë¡œì»¬) â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function saveDraftToStorage() {
    const title = $("#test-title-input").value.trim();
    const body = $("#test-body-textarea").value;
    const payload = {
      applicant,
      title,
      body,
      deadline: deadline ? deadline.toISOString() : null,
      submitted,
      testStatus,
      testId
    };
    localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€ ì„ì‹œ ì €ì¥ (ë¸Œë¼ìš°ì € ë¡œì»¬) â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function saveDraftToStorage() {
    const title = $("#test-title-input").value.trim();
    const body = $("#test-body-textarea").value;
    const payload = {
      applicant,
      title,
      body,
      deadline: deadline ? deadline.toISOString() : null,
      submitted,
      testStatus,
      testId
    };
    localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
  }

  // â˜… ë¡œì»¬ ì´ˆê¹ƒê°’ + ì„œë²„ì™€ ë™ê¸°í™” (ì‚­ì œ / ìƒíƒœ ë³€ê²½ ë°˜ì˜)
  async function loadDraftFromStorageIfExists() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return;
      const data = JSON.parse(raw);
      if (!data) return;

      // ê¸°ë³¸ ì •ë³´ / ë¡œì»¬ ì´ˆê¹ƒê°’ ë°˜ì˜
      applicant = data.applicant || applicant;
      deadline = data.deadline ? new Date(data.deadline) : null;
      submitted = !!data.submitted;
      testStatus = data.testStatus || "waiting";
      testId = data.testId || null;

      $("#name-input").value = applicant.name || "";
      $("#birthyear-select").value = applicant.birthYear || "";
      $("#phone-last4-input").value = applicant.phoneLast4 || "";

      $("#test-title-input").value = data.title || "";
      $("#test-body-textarea").value = data.body || "";

      // ì„œë²„ì™€ ë™ê¸°í™”: testIdê°€ ìˆëŠ”ë° ê´€ë¦¬ìê°€ ìƒíƒœë¥¼ ë°”ê¾¸ê±°ë‚˜ ì‚­ì œí–ˆì„ ìˆ˜ ìˆìŒ
      if (testId) {
        try {
          const res = await fetch(
            "/api/writer-test/get?testId=" + encodeURIComponent(testId)
          );
          const serverData = await res.json();

          if (res.status === 404 || (serverData && serverData.error === "not_found")) {
            // ê´€ë¦¬ìê°€ í•´ë‹¹ TESTë¥¼ ì‚­ì œí•œ ê²½ìš° â†’ ë¡œì»¬ ì •ë³´ ì´ˆê¸°í™”
            testId = null;
            submitted = false;
            testStatus = "waiting";
            deadline = null;

            $("#test-title-input").value = "";
            $("#test-body-textarea").value = "";

            localStorage.removeItem(STORAGE_KEY);
          } else if (res.ok && serverData && serverData.ok && serverData.test) {
            const t = serverData.test;
            testStatus = t.status || testStatus;
            submitted = !!t.submittedAt;

            $("#test-title-input").value = t.title || "";
            $("#test-body-textarea").value = t.content || "";

            if (t.deadlineAt) {
              deadline = new Date(t.deadlineAt.replace(" ", "T"));
            }
          }
        } catch (e) {
          console.error("sync test status error", e);
        }
      }

      if (applicant.name) {
        $("#applicant-summary").textContent =
          applicant.name +
          " / " +
          applicant.birthYear +
          "ë…„ìƒ / íœ´ëŒ€í° ë’·ìë¦¬ " +
          applicant.phoneLast4;
      }

      if (submitted) {
        updateSubmitStatusChip();
        $("#submit-test-btn").disabled = true;
        $("#save-draft-btn").disabled = true;
        $("#result-wait-box").style.display = "block";

        const viewBtn = $("#view-result-btn");
        if (viewBtn) viewBtn.style.display = "inline-flex";

        setStep(3);
      } else {
        updateSubmitStatusChip();
      }

      updateCharCount();
    } catch (e) {
      console.error("draft load error", e);
    }
  }

// â”€â”€â”€â”€â”€â”€â”€â”€â”€ STEP1: ì•ˆë‚´ & ê¸°ë³¸ ì •ë³´ â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function openWarningModal() {
  clearError();
  const name = $("#name-input").value.trim();
  const birthYear = $("#birthyear-select").value;
  const phoneLast4 = $("#phone-last4-input").value.trim();
  const consent = $("#info-consent-checkbox").checked;

  if (!name) {
    showError("ì´ë¦„ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.");
    return;
  }
  if (!birthYear) {
    showError("ì¶œìƒì—°ë„ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.");
    return;
  }
  if (!phoneLast4 || phoneLast4.length !== 4 || !/^\d{4}$/.test(phoneLast4)) {
    showError("íœ´ëŒ€í° ë²ˆí˜¸ ë’·ìë¦¬ 4ìë¦¬ë¥¼ ì •í™•íˆ ì…ë ¥í•´ ì£¼ì„¸ìš”.");
    return;
  }
  if (!consent) {
    showError("ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš© ì•ˆë‚´ì— ë™ì˜í•´ ì£¼ì„¸ìš”.");
    return;
  }

  // 1) TEST ë§ˆê° ì—¬ë¶€ ë¨¼ì € í™•ì¸
  try {
    const res = await fetch("/api/writer-test/config");
    const data = await res.json();

    if (!res.ok) throw new Error("config error");

    if (!data.test_open) {
      // TEST ë§ˆê° ìƒíƒœ â†’ ì•ˆë‚´ë¬¸ ë‹¨ê³„ì—ì„œ ë°”ë¡œ ë§‰ê¸°
      showError(
        "í˜„ì¬ TESTëŠ” ë§ˆê°ëœ ìƒíƒœì…ë‹ˆë‹¤.\n" +
          "ì•ˆë‚´ë¬¸ë§Œ í™•ì¸ ê°€ëŠ¥í•˜ë©°, ë‹¤ìŒ ëª¨ì§‘ ê³µì§€ ë•Œ ë‹¤ì‹œ ì§€ì›í•´ ì£¼ì„¸ìš”."
      );
      return;
    }
  } catch (e) {
    console.error("config load error:", e);
    showError(
      "í˜„ì¬ TEST ìƒíƒœë¥¼ í™•ì¸í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\nì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”."
    );
    return;
  }

  // 2) TEST ì—´ë¦¼ ìƒíƒœì¸ ê²½ìš°ì—ë§Œ í™•ì¸ ëª¨ë‹¬ ì˜¤í”ˆ
  applicant = { name, birthYear, phoneLast4 };
  $("#applicant-summary").textContent =
    name + " / " + birthYear + "ë…„ìƒ / íœ´ëŒ€í° ë’·ìë¦¬ " + phoneLast4;

  $("#warning-modal-backdrop").style.display = "flex";
}

function closeWarningModal() {
  $("#warning-modal-backdrop").style.display = "none";
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€ STEP2: TEST ì‹œì‘ (ì„œë²„ register í˜¸ì¶œ) â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function startTest() {
  closeWarningModal();
  clearError();

  try {
    const res = await fetch("/api/writer-test/register", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        name: applicant.name,
        birthYear: applicant.birthYear,
        phoneLast4: applicant.phoneLast4
      })
    });
    const data = await res.json();

    if (!res.ok || !data.ok) {
      console.error("register error:", data);

      let msg =
        "ì„œë²„ì™€ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.";

      // TEST ë§ˆê°(ë°±ì—”ë“œ ë³´í˜¸ ë¡œì§) â€“ í˜¹ì‹œë¼ë„ config í˜¸ì¶œ ì‹¤íŒ¨ ì‹œ ëŒ€ë¹„
      if (data && data.reason === "closed") {
        msg =
          "í˜„ì¬ TESTëŠ” ë§ˆê°ëœ ìƒíƒœì…ë‹ˆë‹¤.\n" +
          "ì•ˆë‚´ë¬¸ë§Œ í™•ì¸ ê°€ëŠ¥í•˜ë©°, ë‹¤ìŒ ëª¨ì§‘ ê³µì§€ì—ì„œ ë‹¤ì‹œ ì§€ì›í•´ ì£¼ì„¸ìš”.";
      } else if (data && data.reason === "blacklisted") {
        // ë¸”ë™ë¦¬ìŠ¤íŠ¸ ì•ˆë‚´ (ì„œë²„ì—ì„œ 403 + reason='blacklisted')
        msg =
          "ì´ì „ì— ì§€ì› ê´€ë ¨ ì´ìŠˆë¡œ ì¸í•´ í˜„ì¬ TEST ì‘ì‹œê°€ ì œí•œëœ ìƒíƒœì…ë‹ˆë‹¤.\n" +
          "ìì„¸í•œ ë‚´ìš©ì€ ë‹´ë‹¹ìì—ê²Œ ë¬¸ì˜í•´ ì£¼ì„¸ìš”.";
      }

      showError(msg);
      return; // â˜… ì‹¤íŒ¨ ì‹œì—ëŠ” ì ˆëŒ€ STEP2 í™”ë©´ìœ¼ë¡œ ê°€ì§€ ì•ŠìŒ
    }

    // ---- ì—¬ê¸°ê¹Œì§€ ì™”ìœ¼ë©´ register ì„±ê³µ â†’ TEST í™”ë©´ìœ¼ë¡œ ì „í™˜ ----
    $("#applicant-section").style.display = "none";
    $("#test-section").style.display = "";
    setStep(2);

    // ì„œë²„ì—ì„œ ë°›ì€ TEST ì •ë³´ ì„¸íŒ…
    testId = data.testId;
    $("#test-title-input").value = data.title || "";
    $("#test-body-textarea").value = data.body || "";
    testStatus = data.status || "pending";

    // â± íƒ€ì´ë¨¸ ê¸°ëŠ¥ ì œê±°: ë§ˆê°ì‹œê°„ì€ ì•ˆë‚´ë¬¸ìœ¼ë¡œë§Œ ì•ˆë‚´í•˜ê³  ì‹¤ì œ ì¹´ìš´íŠ¸ë‹¤ìš´ì€ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
    deadline = null;

    updateCharCount();
    saveDraftToStorage();
  } catch (e) {
    console.error(e);
    showError(
      "ì„œë²„ì™€ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”."
    );
  }
}

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€ ê¸€ì ìˆ˜ (ê³µë°± ì œì™¸ 2,000ì ê¸°ì¤€) â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function updateCharCount() {
    const textarea = $("#test-body-textarea");
    const countEl = $("#char-count");
    const submitBtn = $("#submit-test-btn");
    const MIN_LEN = 2000;

    const text = textarea ? textarea.value || "" : "";
    const nonWsLength = getNonWhitespaceLength(text);

    if (countEl) {
      countEl.textContent =
        "ê³µë°± ì œì™¸ " +
        nonWsLength.toLocaleString() +
        "ì (ìµœì†Œ " +
        MIN_LEN.toLocaleString() +
        "ì ì´ìƒ ì‘ì„± ì‹œ ì œì¶œ ê°€ëŠ¥)";
    }

    if (submitBtn) {
      submitBtn.disabled = submitted || nonWsLength < MIN_LEN;
    }
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€ ì„ì‹œ ì €ì¥ ë²„íŠ¼ (ë¸Œë¼ìš°ì € ë¡œì»¬ + ì„œë²„) â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function handleSaveDraft() {
    clearError();

    if (!testId) {
      alert("ë¨¼ì € TESTë¥¼ ì‹œì‘í•´ ì£¼ì„¸ìš”.\n(ì§€ì›ì ì •ë³´ ì…ë ¥ í›„ TEST ì‹œì‘ ë²„íŠ¼ì„ ëˆŒëŸ¬ì•¼ í•©ë‹ˆë‹¤.)");
      return;
    }

    const title = $("#test-title-input").value.trim();
    const body = $("#test-body-textarea").value;

    // 1) ë¸Œë¼ìš°ì € ë¡œì»¬ì— ë¨¼ì € ì €ì¥
    saveDraftToStorage();

    // 2) ì„œë²„ì—ë„ ì„ì‹œ ì €ì¥ (DB writer_tests.body / char_count ì—…ë°ì´íŠ¸)
    try {
      const res = await fetch("/api/writer-test/save_draft", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          testId,
          title,
          body
        })
      });
      const data = await res.json();

      if (!res.ok || !data.ok) {
        console.error("save_draft error:", data);
        alert("ë¸Œë¼ìš°ì €ì—ëŠ” ì„ì‹œì €ì¥ ë˜ì—ˆì§€ë§Œ,\nì„œë²„ ì„ì‹œì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        return;
      }
    } catch (e) {
      console.error(e);
      alert("ë¸Œë¼ìš°ì €ì—ëŠ” ì„ì‹œì €ì¥ ë˜ì—ˆì§€ë§Œ,\nì„œë²„ ì„ì‹œì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
      return;
    }

    alert("ì„ì‹œì €ì¥ ë˜ì—ˆìŠµë‹ˆë‹¤.\në™ì¼ PCÂ·ë¸Œë¼ìš°ì €ì—ì„œ ì´ì–´ì„œ ì‘ì„±í•  ìˆ˜ ìˆê³ ,\nì„œë²„ì—ë„ ì„ì‹œ ë‚´ìš©ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€ STEP3: ê²°ê³¼ ë³´ê¸° ì„¹ì…˜ â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function showResultSection() {
    clearError();

    if (!testId) {
      showError("TEST ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í›„ ë‹¤ì‹œ ì‹œì‘í•´ ì£¼ì„¸ìš”.");
      return;
    }

    try {
      const res = await fetch("/api/writer-test/result?testId=" + encodeURIComponent(testId));
      const data = await res.json();

      if (res.status === 404 || (data && data.reason === "not_found")) {
        console.error("result not found:", data);
        showError("TEST ì •ë³´ê°€ ì‚­ì œë˜ì—ˆê±°ë‚˜ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨ í›„ ë‹¤ì‹œ ì§„í–‰í•´ ì£¼ì„¸ìš”.");
        // ë¡œì»¬ ì €ì¥ ì •ë³´ë„ í•¨ê»˜ ì´ˆê¸°í™”
        submitted = false;
        testStatus = "waiting";
        testId = null;
        localStorage.removeItem(STORAGE_KEY);
        updateSubmitStatusChip();
        return;
      }

      if (!res.ok || data.ok === false) {
        console.error("result error:", data);
        showError("ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.");
        return;
      }

      // ì„œë²„ ê¸°ì¤€ ìƒíƒœ ë°˜ì˜
      testStatus = data.status || "pending";
      submitted = !!data.submittedAt;

// ğŸ”´ ì„œë²„ ìƒíƒœê°€ 'return'ì´ë©´ í•­ìƒ ë‹¤ì‹œ ìˆ˜ì •Â·ì œì¶œ ê°€ëŠ¥í•´ì•¼ í•¨
if (testStatus === "return") {
  submitted = false;
}

      if (!submitted) {
        showError("ë¨¼ì € TEST ì›ê³ ë¥¼ ìµœì¢… ì œì¶œí•´ ì£¼ì„¸ìš”.");
        return;
      }

      saveDraftToStorage();
      updateSubmitStatusChip();
    } catch (e) {
      console.error(e);
      showError("ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.");
      return;
    }

    $("#applicant-section").style.display = "none";
    $("#test-section").style.display = "none";
    $("#result-section").style.display = "block";
    setStep(3);

    updateResultUI(testStatus);
  }

  function updateResultUI(status) {
    const waitEl = $("#result-waiting");
    const returnEl = $("#result-return");
    const passEl = $("#result-pass");
    const failEl = $("#result-fail");

    waitEl.style.display = "none";
    if (returnEl) returnEl.style.display = "none";
    passEl.style.display = "none";
    failEl.style.display = "none";

    if (status === "pass") {
      passEl.style.display = "block";
    } else if (status === "fail") {
      failEl.style.display = "block";
    } else if (status === "return") {
      if (returnEl) returnEl.style.display = "block";
    } else {
      waitEl.style.display = "block";
    }
  }

  // ë°˜ë ¤ í›„ ë‹¤ì‹œ ìˆ˜ì •í•˜ê¸°
  function reopenTestForEdit() {
    // ê²°ê³¼ ì„¹ì…˜ ìˆ¨ê¸°ê³  ì‘ì„± ì„¹ì…˜ ë‹¤ì‹œ í‘œì‹œ
    $("#result-section").style.display = "none";
    $("#test-section").style.display = "block";
    setStep(2);

    // ë‹¤ì‹œ ì œì¶œ ê°€ëŠ¥í•˜ë„ë¡ ìƒíƒœ ì´ˆê¸°í™”
    submitted = false;
    testStatus = "pending";

    const submitBtn = $("#submit-test-btn");
    const saveBtn = $("#save-draft-btn");
    if (submitBtn) submitBtn.disabled = false;
    if (saveBtn) saveBtn.disabled = false;

    const waitBox = $("#result-wait-box");
    if (waitBox) waitBox.style.display = "none";

    updateSubmitStatusChip();
    saveDraftToStorage();
  }

  // í•©ê²© ì‹œ ì‹ ê·œì‘ê°€ë“±ë¡ í˜ì´ì§€ë¡œ ì´ë™
  function goToRegisterPage() {
    if (!applicant.name) {
      alert("ì§€ì›ì ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ìºì‹œë¥¼ ì‚­ì œí•˜ì§€ ì•Šì•˜ë‹¤ë©´ TEST í˜ì´ì§€ì—ì„œ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.");
      return;
    }
    const params = new URLSearchParams({
      name: applicant.name,
      birth: applicant.birthYear,
      last4: applicant.phoneLast4
    });
    window.location.href = "ì‹ ê·œì‘ê°€ë“±ë¡.html?" + params.toString();
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€ ìµœì¢… ì œì¶œ: ì„œë²„ /submit í˜¸ì¶œ â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function handleSubmitTest() {
    clearError();

    if (submitted) {
      showError("ì´ë¯¸ ì œì¶œëœ TESTì…ë‹ˆë‹¤.");
      return;
    }

    if (!testId) {
      showError("TEST ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í›„ ë‹¤ì‹œ ì‹œì‘í•´ ì£¼ì„¸ìš”.");
      return;
    }

    // â± íƒ€ì´ë¨¸ ì œê±°: ë§ˆê° ì‹œê°„ ê¸°ì¤€ìœ¼ë¡œ ì œì¶œì„ ë§‰ì§€ ì•ŠìŒ
    // (ìµì¼ ì˜¤í›„ 1ì‹œ ë§ˆê°ì€ ì•ˆë‚´ë¬¸ìœ¼ë¡œë§Œ ê³ ì§€)

    const title = $("#test-title-input").value.trim();
    const body = $("#test-body-textarea").value.trim();

    if (!title) {
      showError("ì œëª©ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.");
      return;
    }

    const nonWsLength = getNonWhitespaceLength(body);
    if (!body || nonWsLength < 2000) {
      showError(
        "ë³¸ë¬¸ ë‚´ìš©ì„ ì¶©ë¶„íˆ ì‘ì„±í•´ ì£¼ì„¸ìš”. (ê³µë°± ì œì™¸ 2,000ì ì´ìƒ ì‘ì„±í•´ì•¼ ì œì¶œ ê°€ëŠ¥í•©ë‹ˆë‹¤.)"
      );
      return;
    }

    const confirmMsg =
      "TEST ì›ê³ ë¥¼ ì œì¶œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\n" +
      "ì œì¶œ í›„ì—ëŠ” ë‹´ë‹¹ìê°€ ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ê²€ìˆ˜í•˜ë©°,\n" +
      "ìˆ˜ì •ì´ í•„ìš”í•  ê²½ìš° ë³„ë„ë¡œ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.";
    if (!window.confirm(confirmMsg)) {
      return;
    }

    try {
      const res = await fetch("/api/writer-test/submit", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          testId,
          title,
          body
        })
      });
      const data = await res.json();

      if (!res.ok || !data.ok) {
        console.error("submit error:", data);
        let msg = "ì„œë²„ë¡œ ì œì¶œí•˜ëŠ” ê³¼ì •ì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.";
        if (data.reason === "too_short") {
          msg = "ì„œë²„ ê¸°ì¤€ ê³µë°± ì œì™¸ ê¸€ì ìˆ˜ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. (í˜„ì¬ " + data.charCount + "ì)";
        } else if (data.reason === "deadline_over") {
          msg = "ë§ˆê° ì‹œê°„ì´ ì§€ë‚˜ ì œì¶œì´ ë¶ˆê°€í•©ë‹ˆë‹¤.";
        }
        showError(msg);
        return;
      }

      submitted = true;
      testStatus = "pending";
      updateSubmitStatusChip();
      const submitBtn = $("#submit-test-btn");
      const saveBtn = $("#save-draft-btn");
      if (submitBtn) submitBtn.disabled = true;
      if (saveBtn) saveBtn.disabled = true;
      $("#result-wait-box").style.display = "block";

      const viewBtn = $("#view-result-btn");
      if (viewBtn) viewBtn.style.display = "inline-flex";

      setStep(3);
      saveDraftToStorage();
      $("#submit-alert").style.display = "block";
    } catch (e) {
      console.error(e);
      showError("ì„œë²„ë¡œ ì œì¶œí•˜ëŠ” ê³¼ì •ì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.");
    }
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€ DOM ë¡œë“œ í›„ ì´ˆê¸°í™” â”€â”€â”€â”€â”€â”€â”€â”€â”€
  window.addEventListener("DOMContentLoaded", function () {
    // ê¸°ë³¸ì€ 1ë‹¨ê³„ë¶€í„°
    setStep(1);
    // ë¡œì»¬/ì„œë²„ ìƒíƒœ ë¶ˆëŸ¬ì˜¤ê¸°
    loadDraftFromStorageIfExists();

    // ğŸ”´ ì´ë¯¸ TESTë¥¼ ìµœì¢… ì œì¶œí•œ ìƒíƒœë¼ë©´
    //     í˜ì´ì§€ ì¬ì ‘ì† ì‹œ ë°”ë¡œ "ê²°ê³¼ í™•ì¸" í™”ë©´ìœ¼ë¡œ ì´ë™
    if (submitted) {
      showResultSection();
    }

    // ê¸€ì ìˆ˜ ë¼ë²¨ ë¬¸êµ¬ ë³€ê²½
    const countLabel = document.querySelector(".editor-footer .left span");
    if (countLabel) {
      countLabel.textContent = "ê¸€ì ìˆ˜ (ê³µë°± ì œì™¸ ê¸°ì¤€)";
    }

    updateCharCount();

    $("#open-warning-btn").addEventListener("click", openWarningModal);
    $("#warning-cancel-btn").addEventListener("click", closeWarningModal);
    $("#warning-confirm-btn").addEventListener("click", startTest);

    $("#test-body-textarea").addEventListener("input", function () {
      updateCharCount();
      saveDraftToStorage();
    });
    $("#test-title-input").addEventListener("input", function () {
      saveDraftToStorage();
    });

    $("#save-draft-btn").addEventListener("click", handleSaveDraft);
    $("#submit-test-btn").addEventListener("click", handleSubmitTest);
    $("#view-result-btn").addEventListener("click", showResultSection);

    const downloadBtn = document.getElementById("download-txt-btn");
    if (downloadBtn) downloadBtn.addEventListener("click", downloadTxtToPC);

    const editAgainBtn = document.getElementById("btn-edit-again");
    if (editAgainBtn) editAgainBtn.addEventListener("click", reopenTestForEdit);

    const goBtn = document.getElementById("btn-go-register");
    if (goBtn) goBtn.addEventListener("click", goToRegisterPage);
  });
</script>
</body>
</html>